{
  "openapi": "3.1.0",
  "info": {
    "title": "permesi",
    "description": "Identity and Access Management",
    "contact": {
      "name": "Team Permesi",
      "email": "team@permesi.dev"
    },
    "license": {
      "name": "BSD-3-Clause",
      "identifier": "BSD-3-Clause"
    },
    "version": "0.3.26"
  },
  "paths": {
    "/health": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Perform a health check of the service and its dependencies.",
        "operationId": "health",
        "responses": {
          "200": {
            "description": "Database and admission PASERK endpoint are healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Health"
                }
              }
            }
          },
          "503": {
            "description": "Database or admission PASERK endpoint is unhealthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Health"
                }
              }
            }
          }
        }
      }
    },
    "/user/login": {
      "post": {
        "tags": [
          "login"
        ],
        "operationId": "login",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserLogin"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/user/register": {
      "post": {
        "tags": [
          "register"
        ],
        "operationId": "register",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserRegister"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Registration successful",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "409": {
            "description": "User with the specified email already exists",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/admin/bootstrap": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "admin_bootstrap",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminBootstrapRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Bootstrap succeeded.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminBootstrapResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session."
          },
          "404": {
            "description": "Bootstrap closed."
          },
          "429": {
            "description": "Rate limited."
          },
          "503": {
            "description": "Vault unavailable."
          }
        }
      }
    },
    "/v1/auth/admin/elevate": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "admin_elevate",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminElevateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Admin token issued.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminElevateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session."
          },
          "403": {
            "description": "Not an operator."
          },
          "429": {
            "description": "Rate limited."
          },
          "503": {
            "description": "Vault unavailable."
          }
        }
      }
    },
    "/v1/auth/admin/infra": {
      "get": {
        "tags": [
          "auth"
        ],
        "operationId": "admin_infra",
        "responses": {
          "200": {
            "description": "Detailed infrastructure status.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminInfraResponse"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid admin token."
          },
          "403": {
            "description": "Not an operator."
          }
        }
      }
    },
    "/v1/auth/admin/status": {
      "get": {
        "tags": [
          "auth"
        ],
        "operationId": "admin_status",
        "responses": {
          "200": {
            "description": "Admin status for the current session.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminStatusResponse"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session."
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "logout",
        "responses": {
          "204": {
            "description": "Session cleared"
          }
        }
      }
    },
    "/v1/auth/mfa/recovery": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Verify a recovery code during MFA challenge and issue a bootstrap session.",
        "operationId": "mfa_recovery",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MfaRecoveryRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Recovery accepted"
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/mfa/totp/enroll/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Finish TOTP enrollment. Requires bootstrap or full session.",
        "operationId": "totp_enroll_finish",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MfaTotpEnrollFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Enrollment finished"
          },
          "400": {
            "description": "Invalid code"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/mfa/totp/enroll/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Start TOTP enrollment. Requires bootstrap or full session.",
        "operationId": "totp_enroll_start",
        "responses": {
          "200": {
            "description": "Enrollment started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MfaTotpEnrollStartResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/mfa/totp/verify": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Verify TOTP during challenge. Requires challenge session.",
        "operationId": "totp_verify",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MfaTotpVerifyRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Verification successful"
          },
          "400": {
            "description": "Invalid code"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/mfa/webauthn/authenticate/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Finishes the `WebAuthn` authentication flow and upgrades the session.",
        "operationId": "authenticate_finish",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/WebauthnAuthenticateFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Authentication successful"
          },
          "400": {
            "description": "Invalid authentication response"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/mfa/webauthn/authenticate/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Starts the authentication flow for a `WebAuthn` security key.",
        "operationId": "authenticate_start",
        "responses": {
          "200": {
            "description": "Authentication challenge generated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebauthnAuthenticateStartResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "No security keys registered"
          }
        }
      }
    },
    "/v1/auth/mfa/webauthn/register/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Finishes the registration of a new `WebAuthn` security key.",
        "description": "Side Effects:\n- Enables MFA (`MfaState::Enabled`) for the user if not already enabled.\n- Logs an audit event.",
        "operationId": "register_finish",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/WebauthnRegisterFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Security key registered successfully"
          },
          "400": {
            "description": "Invalid registration response"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/mfa/webauthn/register/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Starts the registration of a new `WebAuthn` security key.",
        "operationId": "register_start",
        "responses": {
          "200": {
            "description": "Registration challenge generated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WebauthnRegisterStartResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/opaque/login/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "opaque_login_finish",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaqueLoginFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Login success"
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/opaque/login/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "opaque_login_start",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaqueLoginStartRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OPAQUE login started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpaqueLoginStartResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/opaque/password/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Finish a password change by storing the new registration record and revoking sessions.",
        "operationId": "opaque_password_finish",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaquePasswordFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Password updated"
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      }
    },
    "/v1/auth/opaque/password/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Start a password change registration flow for the authenticated user.",
        "operationId": "opaque_password_start",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaquePasswordStartRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OPAQUE password change started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpaquePasswordStartResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      }
    },
    "/v1/auth/opaque/reauth/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Finish a password re-auth flow and refresh the session auth timestamp.",
        "operationId": "opaque_reauth_finish",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaqueReauthFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Re-auth success"
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      }
    },
    "/v1/auth/opaque/reauth/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Start a password re-auth flow for the current session user.",
        "operationId": "opaque_reauth_start",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaqueReauthStartRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OPAQUE re-auth started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpaqueLoginStartResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/opaque/signup/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "opaque_signup_finish",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaqueSignupFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Signup accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpaqueSignupFinishResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/opaque/signup/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "operationId": "opaque_signup_start",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OpaqueSignupStartRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OPAQUE signup started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OpaqueSignupStartResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/passkey/login/finish": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Finish passkey login and issue a session cookie.",
        "operationId": "passkey_login_finish",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PasskeyLoginFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Passkey login finished"
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/passkey/login/start": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Start passkey login by issuing an authentication challenge.",
        "operationId": "passkey_login_start",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PasskeyLoginStartRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Passkey login started",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PasskeyLoginStartResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "429": {
            "description": "Rate limited"
          }
        }
      }
    },
    "/v1/auth/resend-verification": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Resend a verification email (always returns 204 to avoid user enumeration).",
        "operationId": "resend_verification",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResendVerificationRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Resend accepted"
          }
        }
      }
    },
    "/v1/auth/session": {
      "get": {
        "tags": [
          "auth"
        ],
        "operationId": "session",
        "responses": {
          "200": {
            "description": "Session is active",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SessionResponse"
                }
              }
            }
          },
          "204": {
            "description": "No active session"
          }
        }
      }
    },
    "/v1/auth/verify-email": {
      "post": {
        "tags": [
          "auth"
        ],
        "summary": "Verify the email link by consuming the hashed token and activating the user.",
        "operationId": "verify_email",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VerifyEmailRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "Email verified"
          },
          "400": {
            "description": "Invalid/expired token",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/me": {
      "get": {
        "tags": [
          "me"
        ],
        "operationId": "get_me",
        "responses": {
          "200": {
            "description": "Return the authenticated user profile.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MeResponse"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      },
      "patch": {
        "tags": [
          "me"
        ],
        "operationId": "patch_me",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MeUpdateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Profile updated.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MeResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid update payload."
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      }
    },
    "/v1/me/mfa/recovery-codes": {
      "post": {
        "tags": [
          "me"
        ],
        "operationId": "regenerate_recovery_codes",
        "responses": {
          "200": {
            "description": "Recovery codes regenerated.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryCodesResponse"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "409": {
            "description": "MFA not enabled."
          }
        }
      }
    },
    "/v1/me/mfa/security-keys": {
      "get": {
        "tags": [
          "me"
        ],
        "operationId": "list_security_keys",
        "responses": {
          "200": {
            "description": "List of registered security keys.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/SecurityKeySummary"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/me/mfa/totp": {
      "delete": {
        "tags": [
          "me"
        ],
        "operationId": "disable_totp",
        "responses": {
          "204": {
            "description": "TOTP disabled."
          },
          "401": {
            "description": "Unauthorized or recent auth required."
          }
        }
      }
    },
    "/v1/me/mfa/webauthn/{credential_id}": {
      "delete": {
        "tags": [
          "me"
        ],
        "summary": "Deletes a registered `WebAuthn` security key.",
        "description": "Side Effects:\n- Disables MFA (`MfaState::Disabled`) if this was the last security key AND no TOTP is configured.\n- Logs an audit event.",
        "operationId": "delete_key",
        "parameters": [
          {
            "name": "credential_id",
            "in": "path",
            "description": "Hex-encoded credential ID",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Security key deleted successfully"
          },
          "400": {
            "description": "Invalid credential id"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Security key not found"
          }
        }
      }
    },
    "/v1/me/sessions": {
      "get": {
        "tags": [
          "me"
        ],
        "operationId": "list_sessions",
        "responses": {
          "200": {
            "description": "Active sessions for the authenticated user.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/SessionSummary"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      }
    },
    "/v1/me/sessions/{sid}": {
      "delete": {
        "tags": [
          "me"
        ],
        "operationId": "revoke_session",
        "parameters": [
          {
            "name": "sid",
            "in": "path",
            "description": "Session id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Session revoked."
          },
          "400": {
            "description": "Invalid session id."
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Session not found."
          }
        }
      }
    },
    "/v1/me/webauthn/credentials": {
      "get": {
        "tags": [
          "me"
        ],
        "summary": "List registered passkeys for the current user.",
        "description": "Returns an empty list in preview mode; requires a full session.",
        "operationId": "list_credentials",
        "responses": {
          "200": {
            "description": "Registered passkeys",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PasskeyCredentialListResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/me/webauthn/credentials/{credential_id}": {
      "delete": {
        "tags": [
          "me"
        ],
        "summary": "Delete a registered passkey by credential id.",
        "description": "Requires a full session and a valid zero token; not supported in preview mode.",
        "operationId": "delete_credential",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "credential_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Passkey deleted"
          },
          "400": {
            "description": "Invalid credential id or missing zero token"
          },
          "401": {
            "description": "Unauthorized"
          },
          "404": {
            "description": "Not found"
          }
        }
      }
    },
    "/v1/me/webauthn/register/finish": {
      "post": {
        "tags": [
          "me"
        ],
        "summary": "Verify and finalize passkey registration for the current user.",
        "description": "Requires a full session and a valid zero token; consumes the one-time\nchallenge and never persists credentials while preview mode is enabled.",
        "operationId": "register_finish",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PasskeyRegisterFinishRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Passkey registration finished",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PasskeyRegisterFinishResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid registration response"
          },
          "401": {
            "description": "Unauthorized"
          },
          "413": {
            "description": "Payload too large"
          },
          "429": {
            "description": "Rate limited"
          }
        }
      }
    },
    "/v1/me/webauthn/register/options": {
      "post": {
        "tags": [
          "me"
        ],
        "summary": "Generate passkey registration options for the current user.",
        "description": "Requires a full session and a valid zero token; binds the challenge to the\ncurrent session and validates the request Origin before issuing options.",
        "operationId": "register_options",
        "parameters": [
          {
            "name": "X-Permesi-Zero-Token",
            "in": "header",
            "description": "Genesis zero token",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Passkey registration options",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PasskeyRegisterOptionsResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "429": {
            "description": "Rate limited"
          }
        }
      }
    },
    "/v1/orgs": {
      "get": {
        "tags": [
          "orgs"
        ],
        "summary": "Lists organizations the authenticated user is an active member of.\nSoft-deleted orgs are excluded, and membership scoping avoids leaking org existence across tenants.\nThe response uses only public `OrgResponse` fields.",
        "operationId": "list_orgs",
        "responses": {
          "200": {
            "description": "List organizations.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/OrgResponse"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          }
        }
      },
      "post": {
        "tags": [
          "orgs"
        ],
        "summary": "Creates a new organization for the authenticated user and returns an `OrgResponse`.\nOn success, the creator is enrolled as an active member and granted the `owner` role.\nThe slug is normalized and collision-resolved on insert; creator name conflicts return `409`.\nThe response intentionally omits membership state and roles.",
        "operationId": "create_org",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateOrgRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Organization created.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrgResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "409": {
            "description": "Organization with this name already exists for this user.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/orgs/{org_slug}": {
      "get": {
        "tags": [
          "orgs"
        ],
        "summary": "Fetches organization details by slug for the authenticated caller.\nReturns `404` for non-members or inactive memberships to reduce cross-tenant enumeration.\nConverts `OrgContext` to `OrgResponse`, excluding roles and membership status.",
        "operationId": "get_org",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Organization detail.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrgResponse"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization not found."
          }
        }
      },
      "patch": {
        "tags": [
          "orgs"
        ],
        "summary": "Updates an organization's name and/or slug and returns the updated `OrgResponse`.\nRequires `OrgContext::can_manage`; otherwise it returns `404` to avoid leaking org existence.\nThe slug is normalized and uniqueness conflicts map to `409`, and roles are never returned.",
        "operationId": "patch_org",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateOrgRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Organization updated.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrgResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization not found."
          }
        }
      }
    },
    "/v1/orgs/{org_slug}/projects": {
      "get": {
        "tags": [
          "projects"
        ],
        "summary": "Lists active (non-deleted) projects for an organization as `ProjectResponse` DTOs.\nOnly active org members can list; non-members receive `404` to avoid tenant leakage.\nThe response returns only project fields, not nested org membership or roles.",
        "operationId": "list_projects",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List projects.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ProjectResponse"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization not found."
          }
        }
      },
      "post": {
        "tags": [
          "projects"
        ],
        "summary": "Creates a project under an organization and returns a `ProjectResponse`.\nCallers must pass `OrgContext::can_manage`; unauthorized callers receive `404` to avoid leaking existence.\nThe slug is normalized and uniqueness violations are mapped to `409`.\nThe response omits any org membership or role information.",
        "operationId": "create_project",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProjectRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Project created.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProjectResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization not found."
          },
          "409": {
            "description": "Project slug already exists.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/orgs/{org_slug}/projects/{project_slug}/envs": {
      "get": {
        "tags": [
          "environments"
        ],
        "summary": "Lists active (non-deleted) environments for a project as `EnvironmentResponse` DTOs.\nRequires org membership and hides project existence from non-members via `404`.\nThe response returns only environment fields, not project/org membership details.",
        "operationId": "list_environments",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "project_slug",
            "in": "path",
            "description": "Project slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List environments.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/EnvironmentResponse"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization or project not found."
          }
        }
      },
      "post": {
        "tags": [
          "environments"
        ],
        "summary": "Creates an environment within a project and returns an `EnvironmentResponse`.\nRequires `OrgContext::can_manage`; unauthorized callers receive `404` to avoid leaking existence.\n`storage::insert_environment` enforces a single `production` tier and gates `non_production`.\nThe response includes only environment DTO fields.",
        "operationId": "create_environment",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "project_slug",
            "in": "path",
            "description": "Project slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateEnvironmentRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Environment created.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvironmentResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization or project not found."
          },
          "409": {
            "description": "Environment conflict.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/orgs/{org_slug}/projects/{project_slug}/envs/{env_slug}/apps": {
      "get": {
        "tags": [
          "applications"
        ],
        "summary": "Lists active (non-deleted) applications for an environment as `ApplicationResponse` DTOs.\nReturns `404` when the org/project/env cannot be resolved for the current principal.\nThe response returns only app fields, not environment or org membership data.",
        "operationId": "list_applications",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "project_slug",
            "in": "path",
            "description": "Project slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "env_slug",
            "in": "path",
            "description": "Environment slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List applications.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ApplicationResponse"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization, project, or environment not found."
          }
        }
      },
      "post": {
        "tags": [
          "applications"
        ],
        "summary": "Creates an application within an environment and returns an `ApplicationResponse`.\nRequires `OrgContext::can_manage` and returns `404` when the org/project/env is inaccessible.\nThe response includes only app fields, not environment or membership details.",
        "operationId": "create_application",
        "parameters": [
          {
            "name": "org_slug",
            "in": "path",
            "description": "Organization slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "project_slug",
            "in": "path",
            "description": "Project slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "env_slug",
            "in": "path",
            "description": "Environment slug",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateApplicationRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Application created.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApplicationResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "404": {
            "description": "Organization, project, or environment not found."
          },
          "409": {
            "description": "Application already exists.",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/v1/users": {
      "get": {
        "tags": [
          "users"
        ],
        "summary": "List users only for requests with a valid full-session cookie.",
        "operationId": "list_users",
        "responses": {
          "200": {
            "description": "List users (role-based).",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/UserSummary"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "403": {
            "description": "Forbidden."
          }
        }
      }
    },
    "/v1/users/{id}": {
      "get": {
        "tags": [
          "users"
        ],
        "summary": "Fetch one user only for requests with a valid full-session cookie.",
        "operationId": "get_user",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "User id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User detail (role-based).",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserDetail"
                }
              }
            }
          },
          "400": {
            "description": "Invalid user id."
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "403": {
            "description": "Forbidden."
          },
          "404": {
            "description": "User not found."
          }
        }
      },
      "delete": {
        "tags": [
          "users"
        ],
        "summary": "Delete a user after session authentication and scope authorization.",
        "operationId": "delete_user",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "User deleted (admin-only)."
          },
          "400": {
            "description": "Invalid user id."
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "403": {
            "description": "Forbidden."
          },
          "404": {
            "description": "User not found."
          }
        }
      },
      "patch": {
        "tags": [
          "users"
        ],
        "summary": "Update user profile fields after session authentication and scope authorization.",
        "operationId": "patch_user",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserUpdateRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "User updated (editor/admin).",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserDetail"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input."
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "403": {
            "description": "Forbidden."
          },
          "404": {
            "description": "User not found."
          }
        }
      }
    },
    "/v1/users/{id}/role": {
      "put": {
        "tags": [
          "users"
        ],
        "summary": "Assign a global role after session authentication and scope authorization.",
        "operationId": "set_user_role",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserRoleRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Role updated (admin-only).",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserRoleResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid role."
          },
          "401": {
            "description": "Missing or invalid session cookie."
          },
          "403": {
            "description": "Forbidden."
          },
          "404": {
            "description": "User not found."
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AdminBootstrapRequest": {
        "type": "object",
        "required": [
          "vault_token"
        ],
        "properties": {
          "note": {
            "type": [
              "string",
              "null"
            ]
          },
          "vault_token": {
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "AdminBootstrapResponse": {
        "type": "object",
        "required": [
          "ok",
          "bootstrap_complete"
        ],
        "properties": {
          "bootstrap_complete": {
            "type": "boolean"
          },
          "ok": {
            "type": "boolean"
          }
        }
      },
      "AdminElevateRequest": {
        "type": "object",
        "required": [
          "vault_token"
        ],
        "properties": {
          "vault_token": {
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "AdminElevateResponse": {
        "type": "object",
        "required": [
          "admin_token",
          "expires_at"
        ],
        "properties": {
          "admin_token": {
            "type": "string"
          },
          "expires_at": {
            "type": "string"
          }
        }
      },
      "AdminInfraResponse": {
        "type": "object",
        "required": [
          "database",
          "vault",
          "platform"
        ],
        "properties": {
          "database": {
            "$ref": "#/components/schemas/DatabaseStats"
          },
          "platform": {
            "$ref": "#/components/schemas/PlatformStats"
          },
          "vault": {
            "$ref": "#/components/schemas/VaultStatus"
          }
        }
      },
      "AdminStatusResponse": {
        "type": "object",
        "required": [
          "bootstrap_open",
          "operator",
          "cooldown_seconds"
        ],
        "properties": {
          "bootstrap_open": {
            "type": "boolean"
          },
          "cooldown_seconds": {
            "type": "integer",
            "format": "int64",
            "minimum": 0
          },
          "operator": {
            "type": "boolean"
          }
        }
      },
      "ApplicationResponse": {
        "type": "object",
        "required": [
          "id",
          "name",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          }
        }
      },
      "CreateApplicationRequest": {
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string"
          }
        }
      },
      "CreateEnvironmentRequest": {
        "type": "object",
        "required": [
          "name",
          "slug"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "tier": {
            "$ref": "#/components/schemas/EnvironmentTier"
          }
        }
      },
      "CreateOrgRequest": {
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "slug": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "CreateProjectRequest": {
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "slug": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "DatabaseStats": {
        "type": "object",
        "required": [
          "status",
          "pool_size",
          "active_connections",
          "idle_connections"
        ],
        "properties": {
          "active_connections": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "idle_connections": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "permesi_size_bytes": {
            "type": [
              "integer",
              "null"
            ],
            "format": "int64"
          },
          "pool_size": {
            "type": "integer",
            "format": "int32",
            "minimum": 0
          },
          "status": {
            "type": "string"
          }
        }
      },
      "EnvironmentResponse": {
        "type": "object",
        "required": [
          "id",
          "slug",
          "name",
          "tier",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "tier": {
            "type": "string"
          }
        }
      },
      "EnvironmentTier": {
        "type": "string",
        "enum": [
          "production",
          "non_production"
        ]
      },
      "Health": {
        "type": "object",
        "required": [
          "commit",
          "name",
          "version",
          "database",
          "admission_keyset"
        ],
        "properties": {
          "admission_keyset": {
            "type": "string"
          },
          "commit": {
            "type": "string"
          },
          "database": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        }
      },
      "MeResponse": {
        "type": "object",
        "required": [
          "id",
          "email",
          "created_at",
          "updated_at",
          "roles",
          "scopes",
          "mfa_enabled",
          "totp_enabled"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "display_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "email": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "locale": {
            "type": [
              "string",
              "null"
            ]
          },
          "mfa_enabled": {
            "type": "boolean"
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "scopes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "totp_enabled": {
            "type": "boolean"
          },
          "updated_at": {
            "type": "string"
          }
        }
      },
      "MeUpdateRequest": {
        "type": "object",
        "properties": {
          "display_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "locale": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "additionalProperties": false
      },
      "MfaRecoveryRequest": {
        "type": "object",
        "description": "Payload for verifying an MFA recovery code during challenge.",
        "required": [
          "code"
        ],
        "properties": {
          "code": {
            "type": "string"
          }
        }
      },
      "MfaTotpEnrollFinishRequest": {
        "type": "object",
        "required": [
          "code",
          "credential_id"
        ],
        "properties": {
          "code": {
            "type": "string"
          },
          "credential_id": {
            "type": "string"
          }
        }
      },
      "MfaTotpEnrollStartResponse": {
        "type": "object",
        "required": [
          "secret",
          "qr_code_url",
          "credential_id"
        ],
        "properties": {
          "credential_id": {
            "type": "string"
          },
          "qr_code_url": {
            "type": "string"
          },
          "secret": {
            "type": "string"
          }
        }
      },
      "MfaTotpVerifyRequest": {
        "type": "object",
        "required": [
          "code"
        ],
        "properties": {
          "code": {
            "type": "string"
          }
        }
      },
      "OpaqueLoginFinishRequest": {
        "type": "object",
        "required": [
          "login_id",
          "email",
          "credential_finalization"
        ],
        "properties": {
          "credential_finalization": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "login_id": {
            "type": "string"
          }
        }
      },
      "OpaqueLoginStartRequest": {
        "type": "object",
        "required": [
          "email",
          "credential_request"
        ],
        "properties": {
          "credential_request": {
            "type": "string"
          },
          "email": {
            "type": "string"
          }
        }
      },
      "OpaqueLoginStartResponse": {
        "type": "object",
        "required": [
          "login_id",
          "credential_response"
        ],
        "properties": {
          "credential_response": {
            "type": "string"
          },
          "login_id": {
            "type": "string"
          }
        }
      },
      "OpaquePasswordFinishRequest": {
        "type": "object",
        "required": [
          "registration_record"
        ],
        "properties": {
          "registration_record": {
            "type": "string"
          }
        }
      },
      "OpaquePasswordStartRequest": {
        "type": "object",
        "required": [
          "registration_request"
        ],
        "properties": {
          "registration_request": {
            "type": "string"
          }
        }
      },
      "OpaquePasswordStartResponse": {
        "type": "object",
        "required": [
          "registration_response"
        ],
        "properties": {
          "registration_response": {
            "type": "string"
          }
        }
      },
      "OpaqueReauthFinishRequest": {
        "type": "object",
        "required": [
          "login_id",
          "credential_finalization"
        ],
        "properties": {
          "credential_finalization": {
            "type": "string"
          },
          "login_id": {
            "type": "string"
          }
        }
      },
      "OpaqueReauthStartRequest": {
        "type": "object",
        "required": [
          "credential_request"
        ],
        "properties": {
          "credential_request": {
            "type": "string"
          }
        }
      },
      "OpaqueSignupFinishRequest": {
        "type": "object",
        "required": [
          "email",
          "registration_record"
        ],
        "properties": {
          "email": {
            "type": "string"
          },
          "registration_record": {
            "type": "string"
          }
        }
      },
      "OpaqueSignupFinishResponse": {
        "type": "object",
        "required": [
          "message"
        ],
        "properties": {
          "message": {
            "type": "string"
          }
        }
      },
      "OpaqueSignupStartRequest": {
        "type": "object",
        "required": [
          "email",
          "registration_request"
        ],
        "properties": {
          "email": {
            "type": "string"
          },
          "registration_request": {
            "type": "string"
          }
        }
      },
      "OpaqueSignupStartResponse": {
        "type": "object",
        "required": [
          "registration_response"
        ],
        "properties": {
          "registration_response": {
            "type": "string"
          }
        }
      },
      "OrgResponse": {
        "type": "object",
        "required": [
          "id",
          "slug",
          "name",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          }
        }
      },
      "PasskeyCredentialListResponse": {
        "type": "object",
        "required": [
          "preview_mode",
          "credentials"
        ],
        "properties": {
          "credentials": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PasskeyCredentialSummary"
            }
          },
          "preview_mode": {
            "type": "boolean"
          }
        }
      },
      "PasskeyCredentialSummary": {
        "type": "object",
        "required": [
          "id"
        ],
        "properties": {
          "created_at": {
            "type": [
              "string",
              "null"
            ]
          },
          "id": {
            "type": "string"
          },
          "label": {
            "type": [
              "string",
              "null"
            ]
          },
          "last_used_at": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "PasskeyLoginFinishRequest": {
        "type": "object",
        "required": [
          "auth_id",
          "response"
        ],
        "properties": {
          "auth_id": {
            "type": "string"
          },
          "response": {}
        },
        "additionalProperties": false
      },
      "PasskeyLoginStartRequest": {
        "type": "object",
        "required": [
          "email"
        ],
        "properties": {
          "email": {
            "type": "string"
          }
        }
      },
      "PasskeyLoginStartResponse": {
        "type": "object",
        "required": [
          "auth_id",
          "challenge"
        ],
        "properties": {
          "auth_id": {
            "type": "string"
          },
          "challenge": {}
        }
      },
      "PasskeyRegisterFinishRequest": {
        "type": "object",
        "required": [
          "reg_id",
          "response"
        ],
        "properties": {
          "reg_id": {
            "type": "string"
          },
          "response": {}
        },
        "additionalProperties": false
      },
      "PasskeyRegisterFinishResponse": {
        "type": "object",
        "required": [
          "stored"
        ],
        "properties": {
          "stored": {
            "type": "boolean"
          },
          "warning": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "PasskeyRegisterOptionsResponse": {
        "type": "object",
        "required": [
          "reg_id",
          "challenge",
          "preview_mode"
        ],
        "properties": {
          "challenge": {},
          "preview_mode": {
            "type": "boolean"
          },
          "reg_id": {
            "type": "string"
          }
        }
      },
      "PlatformStats": {
        "type": "object",
        "required": [
          "operator_count",
          "recent_attempts_count"
        ],
        "properties": {
          "operator_count": {
            "type": "integer",
            "format": "int64"
          },
          "recent_attempts_count": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "ProjectResponse": {
        "type": "object",
        "required": [
          "id",
          "slug",
          "name",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          }
        }
      },
      "RecoveryCodesResponse": {
        "type": "object",
        "required": [
          "codes"
        ],
        "properties": {
          "codes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ResendVerificationRequest": {
        "type": "object",
        "required": [
          "email"
        ],
        "properties": {
          "email": {
            "type": "string"
          }
        }
      },
      "SecurityKeySummary": {
        "type": "object",
        "required": [
          "credential_id",
          "label",
          "created_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "credential_id": {
            "type": "string"
          },
          "label": {
            "type": "string"
          },
          "last_used_at": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "SessionKind": {
        "type": "string",
        "description": "Session kinds used to gate MFA bootstrap and challenge flows.",
        "enum": [
          "full",
          "mfa_bootstrap",
          "mfa_challenge"
        ]
      },
      "SessionResponse": {
        "type": "object",
        "required": [
          "user_id",
          "email",
          "is_operator",
          "session_kind",
          "totp_enabled",
          "webauthn_enabled"
        ],
        "properties": {
          "email": {
            "type": "string"
          },
          "is_operator": {
            "type": "boolean"
          },
          "session_kind": {
            "$ref": "#/components/schemas/SessionKind"
          },
          "totp_enabled": {
            "type": "boolean"
          },
          "user_id": {
            "type": "string"
          },
          "webauthn_enabled": {
            "type": "boolean"
          }
        }
      },
      "SessionSummary": {
        "type": "object",
        "required": [
          "id",
          "created_at",
          "expires_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "expires_at": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "last_seen_at": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "UpdateOrgRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": [
              "string",
              "null"
            ]
          },
          "slug": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      },
      "UserDetail": {
        "type": "object",
        "required": [
          "id",
          "email",
          "created_at",
          "updated_at"
        ],
        "properties": {
          "created_at": {
            "type": "string"
          },
          "display_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "email": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "locale": {
            "type": [
              "string",
              "null"
            ]
          },
          "role": {
            "type": [
              "string",
              "null"
            ]
          },
          "updated_at": {
            "type": "string"
          }
        }
      },
      "UserLogin": {
        "type": "object",
        "required": [
          "email",
          "password",
          "token"
        ],
        "properties": {
          "email": {
            "type": "string"
          },
          "password": {
            "type": "string"
          },
          "recaptcha": {
            "type": [
              "string",
              "null"
            ]
          },
          "token": {
            "type": "string"
          }
        }
      },
      "UserRegister": {
        "type": "object",
        "required": [
          "email",
          "password",
          "token"
        ],
        "properties": {
          "email": {
            "type": "string"
          },
          "password": {
            "type": "string"
          },
          "recaptcha": {
            "type": [
              "string",
              "null"
            ]
          },
          "token": {
            "type": "string"
          }
        }
      },
      "UserRoleRequest": {
        "type": "object",
        "required": [
          "role"
        ],
        "properties": {
          "role": {
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "UserRoleResponse": {
        "type": "object",
        "required": [
          "id",
          "role",
          "assigned_at"
        ],
        "properties": {
          "assigned_at": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "role": {
            "type": "string"
          }
        }
      },
      "UserSummary": {
        "type": "object",
        "required": [
          "id",
          "email"
        ],
        "properties": {
          "display_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "email": {
            "type": "string"
          },
          "id": {
            "type": "string"
          }
        }
      },
      "UserUpdateRequest": {
        "type": "object",
        "properties": {
          "display_name": {
            "type": [
              "string",
              "null"
            ]
          },
          "locale": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "additionalProperties": false
      },
      "VaultStatus": {
        "type": "object",
        "required": [
          "status",
          "version",
          "sealed"
        ],
        "properties": {
          "sealed": {
            "type": "boolean"
          },
          "status": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        }
      },
      "VerifyEmailRequest": {
        "type": "object",
        "required": [
          "token"
        ],
        "properties": {
          "token": {
            "type": "string"
          }
        }
      },
      "WebauthnAuthenticateFinishRequest": {
        "type": "object",
        "required": [
          "auth_id",
          "response"
        ],
        "properties": {
          "auth_id": {
            "type": "string"
          },
          "response": {}
        }
      },
      "WebauthnAuthenticateStartResponse": {
        "type": "object",
        "required": [
          "auth_id",
          "challenge"
        ],
        "properties": {
          "auth_id": {
            "type": "string"
          },
          "challenge": {}
        }
      },
      "WebauthnRegisterFinishRequest": {
        "type": "object",
        "required": [
          "reg_id",
          "label",
          "response"
        ],
        "properties": {
          "label": {
            "type": "string"
          },
          "reg_id": {
            "type": "string"
          },
          "response": {}
        }
      },
      "WebauthnRegisterStartResponse": {
        "type": "object",
        "required": [
          "reg_id",
          "challenge"
        ],
        "properties": {
          "challenge": {},
          "reg_id": {
            "type": "string"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "permesi",
      "description": "Identity and access management API"
    },
    {
      "name": "auth",
      "description": "Signup and email verification"
    },
    {
      "name": "me",
      "description": "Current user self-service endpoints"
    },
    {
      "name": "users",
      "description": "Global user management"
    },
    {
      "name": "orgs",
      "description": "Organization endpoints"
    },
    {
      "name": "projects",
      "description": "Project endpoints"
    },
    {
      "name": "environments",
      "description": "Environment endpoints"
    },
    {
      "name": "applications",
      "description": "Application endpoints"
    }
  ]
}
